# TimeFiles 需求文档（PRD v0.1）

- 版本：v0.1
- 状态：草案
- 日期：2026-02-24
- 项目名：TimeFiles（时间都去哪儿了）
- 定位：个人开源桌面应用（Tauri + Svelte + Rust），以任务树为中心进行时间追踪与瓶颈诊断

## 1. 背景与问题

当前工作中的主要痛点：

- 不清楚时间具体消耗在什么任务与子任务上。
- 固定时长番茄钟（如 25/40 分钟）对不同任务不够灵活，可能打断深度专注。
- 缺乏可追溯的数据，无法长期识别个人效率瓶颈和薄弱任务类型。

## 2. 产品目标

TimeFiles 的核心目标：

- 以“任务”为中心记录时间，而不是以固定番茄周期为中心。
- 支持任务递归拆分，允许任务执行过程中动态插入子任务。
- 精确统计每个任务节点的独立耗时与总耗时，定位瓶颈。
- 基于任务边界提供“自适应休息建议”，替代固定番茄钟。

## 3. 术语定义

- 任务（Task）：可被计时、可打标签的工作单元。
- 子任务（Subtask）：任务的子节点，支持递归嵌套。
- 任务树（Task Tree）：任务与子任务形成的层级结构。
- 总耗时（Inclusive Time）：某任务自身耗时 + 全部后代子任务耗时。
- 独立耗时（Exclusive Time）：仅某任务本身耗时，不含子任务耗时。
- 事件流（Event Log）：用于重放/修正统计的计时事件记录（start/pause/resume/stop 等）。

## 4. 用户与场景

目标用户（当前）：

- 个人开发者/知识工作者（项目作者本人）。

高频场景：

- 开始一个主任务后，临时插入多个子任务并返回继续。
- 回顾某天/某周时间分配，分析哪些任务类型耗时异常。
- 在子任务切换边界判断是否需要短休息而不是机械中断。

## 5. 产品范围

### 5.1 MVP（v0.1 必做）

- 任务树管理：创建/编辑/归档任务，支持无限层级子任务。
- 任务计时：开始、暂停、恢复、停止。
- 运行中插入子任务：父任务自动暂停，子任务结束后父任务自动恢复。
- 标签系统：任务可添加多个标签（手动输入）。
- 时间统计：每个任务展示 `inclusive_time` 与 `exclusive_time`；支持按标签、按时间范围（日/周）聚合统计。
- 自适应休息（规则版）：在“子任务结束”或“任务切换”时给出休息建议（不强制）；建议档位为不休息 / 3 分钟 / 8 分钟 / 15 分钟。
- 本地优先存储：所有数据默认存储在本地。

### 5.2 非 MVP（后续版本）

- AI 自动标签建议。
- 语音输入创建任务。
- AI 瓶颈分析报告（自然语言解释）。
- 基于系统行为的分神检测（应用切换、空闲、窗口类别匹配等）。
- 跨设备同步与多人协作。

## 6. 功能需求（MVP）

### FR-001 任务树

- 系统应支持任务的新增、重命名、删除（软删除）和父子关系调整。
- 系统应支持至少 10 层以上的任务嵌套。
- 系统应避免循环引用（任务不能成为自己的后代）。

验收标准：

- 用户可在任意任务下创建子任务并立即可见。
- 调整父子关系后，树结构仍合法且统计可重算。

### FR-002 计时状态机

- 任务计时状态包括：`idle`、`running`、`paused`、`stopped`。
- 同一时刻仅允许一个“活动计时上下文”（单用户单设备）。
- 允许在运行任务中插入子任务：插入时父任务自动 `pause`；子任务 `start` 后进入 `running`；子任务 `stop` 后父任务自动 `resume`（若父任务存在）。

验收标准：

- 任意时刻不存在两个并发 `running` 任务。
- 子任务完成返回父任务后，父任务继续累计时间。

### FR-003 标签系统

- 任务应支持 0~N 个标签。
- 标签可复用，支持按标签筛选任务和统计。

验收标准：

- 用户可为任务添加/删除标签。
- 统计页可按标签查看耗时汇总。

### FR-004 时间统计与瓶颈提示

- 系统应计算并展示：单任务 `inclusive_time` 与 `exclusive_time`；任务树各节点耗时占比；按标签聚合耗时（天/周）。
- 系统应提供基础瓶颈提示（规则版），例如“某标签本周耗时占比显著上升”、“某任务 `exclusive_time` 持续高于历史中位数”。

验收标准：

- 相同原始事件在多次重算后结果一致。
- 用户可在 UI 上看到任务级与标签级统计数据。

### FR-005 自适应休息建议（规则版）

- 系统在“子任务结束”或“任务切换”事件触发时计算休息建议。
- 规则输入至少包括：连续专注时长、最近任务切换频率、当前任务与历史时长偏差。
- 输出建议档位：`0/3/8/15` 分钟。

验收标准：

- 建议不强制打断当前任务。
- 用户可一键接受或忽略建议。

### FR-006 事件流与可追溯性

- 所有计时相关动作写入事件日志（含时间戳、任务 ID、动作类型）。
- 支持从事件日志重放出任务时长统计结果。

验收标准：

- 删除统计缓存后可从事件日志完整重建统计。
- 关键事件具备不可歧义的顺序与时间戳。

## 7. 非功能需求

### NFR-001 性能

- 常见操作响应时间目标：开始任务 <= 200ms；插入子任务 <= 300ms；周级统计刷新 <= 1s（中小数据量下）。

### NFR-002 可靠性

- 异常退出后应尽量恢复最近一次运行中的任务状态。
- 事件写入采用追加模式，避免覆盖导致数据丢失。

### NFR-003 可用性

- 用户在 2 秒内可启动一个任务；在 1 秒内可插入子任务（含快捷操作）。

### NFR-004 隐私

- 默认本地离线可用。
- 分神检测等敏感能力默认关闭，需显式开启。

## 8. 数据与统计口径（MVP）

最小数据实体：

- Task：`id, parent_id, title, status, created_at, archived_at`
- Tag：`id, name`
- TaskTag：`task_id, tag_id`
- TimeEvent：`id, task_id, event_type, ts, payload`

统计口径：

- `inclusive_time`：节点自身运行时长 + 全部后代运行时长。
- `exclusive_time`：节点运行时长 - 其直接/间接子任务运行时长。
- 主看板优先展示 `exclusive_time` 排名，用于定位“本体瓶颈”。

## 9. 约束与风险

- 过细任务拆分可能带来记录负担，降低使用持续性。
- 若状态机与事件顺序定义不严谨，统计会出现偏差。
- 分神检测涉及隐私与误判风险，应后置并提供透明开关。

## 10. 里程碑（建议）

- M1：任务树 + 基础计时 + 事件流（可稳定记录）
- M2：统计页（任务/标签）+ inclusive/exclusive 计算
- M3：自适应休息建议（规则版）+ 基础瓶颈提示
- M4：体验优化（快捷键、快速录入、常用标签）

## 11. 开放问题

- “并行任务”是否永不支持，还是未来引入多上下文模式？
- 标签体系是否采用“自由标签”还是“受控词表 + 自定义”混合？
- 自适应休息建议的初始规则阈值如何设定（固定阈值 vs 用户自学习）？

## 12. 成功指标（MVP）

- 连续使用 14 天的日活留存（个人项目可替换为“作者持续使用天数”）。
- 每日有效记录任务数（含子任务）稳定增长。
- 用户可明确指出至少 3 个高耗时瓶颈标签或任务类型。
